<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Garir Dokan Invoice Pro - Final Version</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #e9ecef; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* ‡¶è‡¶°‡¶ø‡¶ü‡¶∞ ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ */
        .no-print { width: 450px; min-width: 450px; background: #fdfdfd; padding: 20px; box-shadow: 2px 0 10px rgba(0,0,0,0.1); overflow-y: auto; box-sizing: border-box; }
        .control-group { margin-bottom: 20px; background: #fff; padding: 15px; border-radius: 12px; border: 1px solid #e0e4e8; box-shadow: 0 2px 4px rgba(0,0,0,0.02); box-sizing: border-box; }
        .control-group label { font-weight: 700; display: block; margin-bottom: 12px; font-size: 14px; color: #333; }

        .flex-input { display: flex; gap: 8px; align-items: center; margin-bottom: 10px; width: 100%; box-sizing: border-box; }
        
        /* ‡¶ü‡¶ó‡¶≤ ‡¶∏‡ßÅ‡¶á‡¶ö */
        .switch { position: relative; display: inline-block; width: 34px; height: 20px; flex-shrink: 0; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #27ae60; }
        input:checked + .slider:before { transform: translateX(14px); }

        input[type="text"], input[type="number"], input[type="date"], input[type="file"] { 
            flex-grow: 1; width: 100%; padding: 8px; border: 1px solid #ced4da; border-radius: 6px; font-size: 13px; box-sizing: border-box; 
        }
        
        input[type="range"] { width: 100%; cursor: pointer; margin-top: 5px; }

        .btn-save { background: #27ae60; color: white; width: 100%; height: 45px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; margin-top: 10px; }
        .btn-add { background: #3498db; color: white; width: 100%; border: none; padding: 10px; border-radius: 6px; cursor: pointer; margin-top: 5px; font-weight: 600; }
        
        .btn-del { background: #e74c3c; color: white; border: none; width: 32px; height: 32px; border-radius: 6px; cursor: pointer; font-weight: bold; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 18px; }

        /* ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶è‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ */
        .preview-area { flex-grow: 1; padding: 40px; overflow-y: auto; display: flex; justify-content: center; background: #525659; }
        #invoice { width: 210mm; min-height: 297mm; padding: 15mm; background: white; position: relative; box-sizing: border-box; color: #000; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        
        /* ‡¶á‡¶®‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
        .logo-box { width: 280px; margin-bottom: 10px; }
        .logo-box img { max-width: 100%; height: auto; display: block; }
        .grey-bar-header { background: #d1d3d4; height: 25px; width: 100%; display: flex; align-items: center; margin-bottom: 20px; }
        .grey-bar-header span { font-family: "Times New Roman", serif; font-size: 14px; padding-left: 15px; font-style: italic; }
        .invoice-header-row { border-bottom: 1px solid #000; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: baseline; }
        .info-grid { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 20px; margin-bottom: 30px; font-size: 14px; }
        .info-row { display: flex; margin-bottom: 4px; }
        .info-label { font-weight: bold; min-width: 100px; }
        
        .main-table { width: 100%; border-collapse: collapse; }
        .main-table th { border-top: 1.5px solid #000; border-bottom: 1.5px solid #000; padding: 10px 5px; text-align: left; font-size: 14px; font-weight: bold; }
        .desc-col { width: 45%; vertical-align: top; }
        
        .car-title-display { font-weight: bold; text-transform: uppercase; margin-bottom: 15px; display: block; }
        .spec-row { display: grid; grid-template-columns: 80px 10px 1fr; margin-bottom: 3px; font-size: 14px; }
        
        .payment-entry { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 0.5px solid #eee; font-size: 13px; }
        .pay-date { width: 140px; vertical-align: top; }
        .pay-amt-box { text-align: right; width: 120px; }
        .main-amt-text { font-weight: bold; display: block; }
        .sub-note-text { font-size: 11px; color: #555; font-style: italic; display: block; margin-top: 2px; text-transform: uppercase; }

        .summary-box { margin-top: 30px; border-top: 1.5px solid #000; padding-top: 10px; }
        .summary-line { display: flex; justify-content: flex-end; margin-bottom: 5px; font-size: 15px; }
        .sum-lbl { width: 120px; text-align: right; padding-right: 20px; }
        .sum-val { width: 140px; text-align: right; border-bottom: 1px solid #ddd; }
        
        .footer-info { position: absolute; bottom: 10mm; width: calc(100% - 30mm); border-top: 1px solid #ccc; padding-top: 10px; text-align: center; }
        .footer-contact-row { display: flex; justify-content: center; align-items: center; gap: 15px; font-size: 12px; color: #000; margin-bottom: 8px; }
        .footer-web-row { font-size: 16px; font-weight: normal; letter-spacing: 5px; text-transform: lowercase; }
        .red-letter { color: #e74c3c; }
        .hidden-row { display: none !important; }
        
        /* ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶´‡¶ø ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
        .reg-fee-text { font-size: 13px; font-weight: normal; display: block; margin-top: 2px; }
    </style>
</head>
<body>

<div class="no-print">
    <h3 style="margin: 0 0 20px 5px; color: #444;">Invoice Editor</h3>
    
    <div class="control-group">
        <label>1. Logo & Font Size</label>
        <input type="file" accept="image/*" onchange="uploadLogo(event)">
        <div style="margin-top: 15px; font-size: 12px; color: #666;">Car Title Size:</div>
        <input type="range" id="fontSizeRange" min="10" max="35" value="18" oninput="update()">
    </div>

    <div class="control-group">
        <label>2. Buyer Info</label>
        <div class="flex-input"><label class="switch"><input type="checkbox" checked onchange="toggleRow('row_name', 'out_row_name')"><span class="slider"></span></label><input type="text" id="in_name" placeholder="Buyer's Name" oninput="update()"></div>
        <div class="flex-input"><label class="switch"><input type="checkbox" checked onchange="toggleRow('row_phone', 'out_row_phone')"><span class="slider"></span></label><input type="text" id="in_phone" placeholder="Phone" oninput="update()"></div>
        <div class="flex-input"><label class="switch"><input type="checkbox" checked onchange="toggleRow('row_address', 'out_row_address')"><span class="slider"></span></label><input type="text" id="in_address" placeholder="Address" oninput="update()"></div>
    </div>

    <div class="control-group">
        <label>3. Invoice Details</label>
        <div class="flex-input"><input type="date" id="in_date_picker" oninput="update()"></div>
        <div class="flex-input"><input type="text" id="in_inv" placeholder="Invoice No." oninput="update()"></div>
    </div>

    <div class="control-group">
        <label>4. Vehicle Info</label>
        <div class="flex-input"><label class="switch"><input type="checkbox" checked onchange="toggleRow('row_title', 'out_car_title')"><span class="slider"></span></label><input type="text" id="in_car_title" placeholder="Vehicle Title" oninput="update()"></div>
        <div class="flex-input"><label class="switch"><input type="checkbox" checked onchange="toggleRow('row_model', 'out_row_model')"><span class="slider"></span></label><input type="text" id="in_model" placeholder="Model" oninput="update()"></div>
        <div class="flex-input"><label class="switch"><input type="checkbox" checked onchange="toggleRow('row_color', 'out_row_color')"><span class="slider"></span></label><input type="text" id="in_color" placeholder="Color" oninput="update()"></div>
        <div class="flex-input"><label class="switch"><input type="checkbox" checked onchange="toggleRow('row_cc', 'out_row_cc')"><span class="slider"></span></label><input type="text" id="in_cc" placeholder="CC" oninput="update()"></div>
        <div class="flex-input"><label class="switch"><input type="checkbox" checked onchange="toggleRow('row_chassis', 'out_row_chassis')"><span class="slider"></span></label><input type="text" id="in_chassis" placeholder="Chassis No." oninput="update()"></div>
        <div class="flex-input"><label class="switch"><input type="checkbox" checked onchange="toggleRow('row_engine', 'out_row_engine')"><span class="slider"></span></label><input type="text" id="in_engine" placeholder="Engine No." oninput="update()"></div>
        <div class="flex-input"><label class="switch"><input type="checkbox" checked onchange="toggleRow('row_price', 'out_row_price')"><span class="slider"></span></label><input type="number" id="in_price" placeholder="Car Price" oninput="updateTotal()"></div>
    </div>

    <div class="control-group">
        <label>5. Payments (With Note Option)</label>
        <div id="payList">
            <div class="flex-input">
                <input type="date" class="p_date_picker" oninput="update()" style="width: 110px; flex-grow: 0;">
                <input type="number" placeholder="Amt" class="p_amt" oninput="updateTotal()" style="width: 80px; flex-grow: 0;">
                <input type="text" placeholder="Note (CASH/CHEQUE)" class="p_note" oninput="update()">
                <button class="btn-del" onclick="this.parentNode.remove(); updateTotal();">‚úï</button>
            </div>
        </div>
        <button class="btn-add" onclick="addRow()">+ Add New Payment Row</button>
    </div>

    <button class="btn-save" onclick="downloadPDF()">Download PDF</button>
</div>

<div class="preview-area">
    <div id="invoice">
        <div class="logo-box"><img id="displayLogo" src=""></div>
        <div class="grey-bar-header"><span>Importer & All kinds of Brand new & Reconditioned Vehicles Supplier</span></div>
        <div class="invoice-header-row">
            <h1 style="margin:0; font-size:32px;">INVOICE</h1>
            <div style="font-size: 11px; font-weight: bold;">CUSTOMER COPY</div>
        </div>
        <div class="info-grid">
            <div>
                <div class="info-row" id="out_row_name"><span class="info-label">Buyer's Name</span><span>: <span id="out_name"></span></span></div>
                <div class="info-row" id="out_row_phone"><span class="info-label">Phone</span><span>: <span id="out_phone"></span></span></div>
                <div class="info-row" id="out_row_address"><span class="info-label">Address</span><span>: <span id="out_address"></span></span></div>
            </div>
            <div>
                <div class="info-row"><span class="info-label">DATE</span><span>: <span id="out_date"></span></span></div>
                <div class="info-row"><span class="info-label">Invoice no.</span><span>: <span id="out_inv"></span></span></div>
            </div>
        </div>
        <table class="main-table">
            <thead>
                <tr>
                    <th style="width: 45%;">DESCRIPTION</th>
                    <th style="width: 35%;">PAYMENT DATE</th>
                    <th style="width: 20%; text-align: right;">AMOUNT</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="desc-col">
                        <span id="out_car_title" class="car-title-display"></span>
                        <div class="spec-row" id="out_row_model"><span>Model</span><span>:</span><span id="out_model"></span></div>
                        <div class="spec-row" id="out_row_color"><span>Color</span><span>:</span><span id="out_color"></span></div>
                        <div class="spec-row" id="out_row_cc"><span>CC</span><span>:</span><span id="out_cc"></span></div>
                        <div class="spec-row" id="out_row_chassis"><span>Chassis no</span><span>:</span><span id="out_chassis"></span></div>
                        <div class="spec-row" id="out_row_engine"><span>Engine no</span><span>:</span><span id="out_engine"></span></div>
                        <br>
                        <div id="out_row_price">
                            <strong>Car price : <span id="out_price">0</span>/-</strong>
                            <span class="reg-fee-text">(Excluding registration fee)</span>
                        </div>
                    </td>
                    <td colspan="2" id="payment_rows_container" style="padding:0; vertical-align: top; border-left: 1px solid #eee;"></td>
                </tr>
            </tbody>
        </table>
        <div class="summary-box">
            <div class="summary-line"><div class="sum-lbl">Total Paid:</div><div class="sum-val"><span id="out_total_paid">0</span>/-</div></div>
            <div class="summary-line" style="font-weight: bold;"><div class="sum-lbl">Balance:</div><div class="sum-val"><span id="out_balance">0</span>/-</div></div>
        </div>

        <div class="footer-info">
            <div class="footer-contact-row">
                <span>üìç A.Hamid Road, Pabna</span>
                <span>‚úâÔ∏è garirdokan2021@gmail.com</span>
                <span>üìû +880 1713 110 570</span>
                <span>üìû +880 1785 2555 86</span>
            </div>
            <div class="footer-web-row">
                w w w . <span class="red-letter">g</span> a r i r <span class="red-letter">d</span> o k a n . c o m
            </div>
        </div>
    </div>
</div>

<script>
    window.onload = function() {
        const savedLogo = localStorage.getItem('invoiceLogo');
        if (savedLogo) {
            document.getElementById('displayLogo').src = savedLogo;
        }
    };

    function toggleRow(inputId, outputId) {
        const outElem = document.getElementById(outputId);
        if(outElem) outElem.classList.toggle('hidden-row');
        updateTotal();
    }
    function formatDate(dateVal) {
        if (!dateVal) return "";
        return new Date(dateVal).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    }
    function uploadLogo(e) {
        const reader = new FileReader();
        reader.onload = () => {
            const logoData = reader.result;
            document.getElementById('displayLogo').src = logoData;
            localStorage.setItem('invoiceLogo', logoData);
        };
        reader.readAsDataURL(e.target.files[0]);
    }
    function addRow() {
        const div = document.createElement('div');
        div.className = 'flex-input';
        div.innerHTML = `
            <input type="date" class="p_date_picker" oninput="update()" style="width: 110px; flex-grow: 0;">
            <input type="number" placeholder="Amt" class="p_amt" oninput="updateTotal()" style="width: 80px; flex-grow: 0;">
            <input type="text" placeholder="Note (CASH/CHEQUE)" class="p_note" oninput="update()">
            <button class="btn-del" onclick="this.parentNode.remove(); updateTotal();">‚úï</button>`;
        document.getElementById('payList').appendChild(div);
        update();
    }
    function update() {
        const mainDate = document.getElementById('in_date_picker').value;
        document.getElementById('out_date').innerText = formatDate(mainDate).toUpperCase();
        const fields = ['name', 'phone', 'address', 'inv', 'car_title', 'model', 'color', 'cc', 'chassis', 'engine'];
        fields.forEach(id => {
            const inVal = document.getElementById('in_' + id).value;
            const outElem = document.getElementById('out_' + id);
            if(outElem) outElem.innerText = inVal;
        });
        document.getElementById('out_car_title').style.fontSize = document.getElementById('fontSizeRange').value + 'px';
        
        const pickers = document.getElementsByClassName('p_date_picker');
        const amts = document.getElementsByClassName('p_amt');
        const notes = document.getElementsByClassName('p_note');
        let html = '';
        for(let i=0; i<pickers.length; i++) {
            html += `
                <div class="payment-entry">
                    <div class="pay-date">${formatDate(pickers[i].value)}</div>
                    <div class="pay-amt-box">
                        <span class="main-amt-text">${Number(amts[i].value).toLocaleString()}/-</span>
                        <span class="sub-note-text">${notes[i].value}</span>
                    </div>
                </div>`;
        }
        document.getElementById('payment_rows_container').innerHTML = html;
    }
    function updateTotal() {
        const amts = document.getElementsByClassName('p_amt');
        let total = 0;
        for(let a of amts) total += Number(a.value);
        const price = Number(document.getElementById('in_price').value);
        document.getElementById('out_price').innerText = price.toLocaleString();
        document.getElementById('out_total_paid').innerText = total.toLocaleString();
        document.getElementById('out_balance').innerText = (price - total).toLocaleString();
        update();
    }
    function downloadPDF() {
        html2pdf().from(document.getElementById('invoice')).set({
            margin: 0, filename: 'Invoice.pdf', html2canvas: { scale: 3 }, jsPDF: { unit: 'mm', format: 'a4' }
        }).save();
    }
</script>
</body>
</html>